---
layout: post
title: 排序 (六)：外部排序算法
subtitle: 海量数据集的处理
author: Hayden Wang
header-img: algorithms.jpg
cdn: header-on
tags: [Algorithm]
date: 2018-02-07 09:00:00
---

在排序的过程中，根据数据元素是否完全在内存中，可将排序算法分为两类：**内部排序**和**外部排序**。

## 外部排序的思想

顾名思义，所谓的外排序就是在内存外面的排序。当要处理的数据量很大而不能一次性装入内存时，只能将数据放在读写较慢的外部存储器（通常是硬盘）上。

外部排序通常采用 “排序-归并” 的策略：在排序阶段，先读入能放在内存中的数据，将其排序后输出到一个临时文件，一次进行，将待排序的数据组织为多个有序的临时文件，而后在归并阶段将这些临时文件组合为一个大的有序文件，即位排序结果。

## 基本方法

> 外排序算法的核心思路在于把文件分块读到内存，在内存中对每块文件依次进行排序，最后合并排序后的各块数据，依次按顺序写回文件。外排序需要进行多次磁盘读写，因此执行效率往往低于内排序，时间主要花费于磁盘读写上。

外排序的算法步骤如下：

假设文件需要分成 k 块读入，需要从小到大进行排序。
1. 依次读入每个文件块，在内存中对当前文件块进行排序（应用恰当的内排序算法）。此时，每块文件相当于一个由小到大排列的有序队列。
2. 在内存中建立一个最小值堆，读入每块文件的队列头。
3. 弹出堆顶元素，如果元素来自第 i 块，则从第 i 块文件中补充一个元素到最小值堆。弹出的元素暂存至临时数组。
4. 当临时数组存满时，将数组写至磁盘，并清空数组内容。
5. 重复过程 3、4，直至所有文件块读取完毕。

